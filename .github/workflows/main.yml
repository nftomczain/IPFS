name: üöÄ Deploy site to IPFS (NetNeroJes Infrastructure)

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ Pobranie repozytorium
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ Instalacja IPFS (Kubo CLI)
      - name: Install IPFS (Kubo)
        run: |
          wget -q https://github.com/ipfs/kubo/releases/download/v0.30.0/kubo_v0.30.0_linux-amd64.tar.gz
          tar -xzf kubo_v0.30.0_linux-amd64.tar.gz
          sudo bash kubo/install.sh
          ipfs version

      # 3Ô∏è‚É£ Dodanie katalogu site/ do IPFS
      - name: Add site directory to IPFS
        id: add_ipfs
        run: |
          CID=$(ipfs add -Qr site)
          echo "üì¶ Added site/ to IPFS ‚Üí $CID"
          echo "CID=$CID" >> $GITHUB_ENV

      # 4Ô∏è‚É£ (opcjonalnie) Przypiƒôcie CID w Pinata (je≈õli token ustawiony)
      - name: Pin to Pinata
        if: env.PINATA_JWT != ''
        env:
          PINATA_JWT: ${{ secrets.PINATA_JWT }}
          CID: ${{ env.CID }}
        run: |
          echo "üîó Pinning CID to Pinata..."
          curl -s -X POST "https://api.pinata.cloud/pinning/pinByHash" \
            -H "Authorization: Bearer $PINATA_JWT" \
            -H "Content-Type: application/json" \
            -d "{\"hashToPin\": \"$CID\", \"name\": \"NetNeroJes-site\"}"
          echo "‚úÖ Pinned: $CID"

      # 5Ô∏è‚É£ Wy≈õwietlenie wyniku
      - name: Show final result
        run: |
          echo "=============================================="
          echo "üåç NetNeroJes Posten Infrastruktura - IPFS CID"
          echo "üîπ CID: $CID"
          echo "üîπ Gateway: https://ipfs.io/ipfs/$CID"
          echo "=============================================="
